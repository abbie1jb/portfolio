<!DOCTYPE HTML>
<!--
	Prologue by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Project Details - Abbie Bambrough</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			.project-details {
				padding: 2rem 0;
			}
			
			.project-header {
				text-align: center;
				margin-bottom: 2rem;
			}
			
			.model-container {
				height: 500px;
				width: 100%;
				border: 1px solid #ddd;
				border-radius: 8px;
				overflow: hidden;
				margin-bottom: 2rem;
				background: #f5f5f5;
			}
			
			.image-gallery {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
				gap: 1rem;
				margin-bottom: 2rem;
			}
			
			.gallery-image {
				width: 100%;
				height: 250px;
				object-fit: cover;
				border-radius: 8px;
				cursor: pointer;
				transition: transform 0.3s ease;
			}
			
			.gallery-image:hover {
				transform: scale(1.05);
			}
			
			.text-content {
				background: #f8f8f8;
				padding: 2rem;
				border-radius: 8px;
				margin-bottom: 2rem;
			}
			
			.back-button {
				display: inline-block;
				margin-bottom: 2rem;
				padding: 0.5rem 1rem;
				background: #4c5c96;
				color: white;
				text-decoration: none;
				border-radius: 4px;
				transition: background 0.3s ease;
			}
			
			.back-button:hover {
				background: #3a4975;
			}
		</style>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<div id="header">
				<div class="top">
					<!-- Logo -->
						<div id="logo">
							<span class="image avatar48"><img src="bam.jpg" alt="" /></span>
							<h1 id="title">Abbie Bambrough</h1>
							<p>Product Design</p>
						</div>

					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="index.html#top" id="top-link"><span class="icon solid fa-home">Home</span></a></li>
								<li><a href="index.html#portfolio" id="portfolio-link"><span class="icon solid fa-th">Portfolio</span></a></li>
								<li><a href="index.html#about" id="about-link"><span class="icon solid fa-user">About Me</span></a></li>
								<li><a href="index.html#contact" id="contact-link"><span class="icon solid fa-envelope">Contact</span></a></li>
							</ul>
						</nav>
				</div>

				<div class="bottom">
					<!-- Social Icons -->
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
							<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
							<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul>
				</div>
			</div>

		<!-- Main -->
			<div id="main">
				<!-- Project Details -->
				<section id="project-details" class="project-details">
					<div class="container">
						<a href="index.html#portfolio" class="back-button">
							<span class="icon solid fa-arrow-left"></span> Back to Portfolio
						</a>
						
						<div class="project-header">
							<h2 id="project-title">Project Details</h2>
						</div>
						
						<!-- Project Image Display -->
						<div class="model-container" id="detail-image-viewer"></div>
						
						<!-- Image Gallery -->
						<div class="image-gallery" id="image-gallery"></div>
						
						<!-- Text Content -->
						<div class="text-content" id="text-content">
							<h3>Project Description</h3>
							<p>Loading project details...</p>
						</div>
					</div>
				</section>
			</div>

		<!-- Footer -->
			<div id="footer">
				<!-- Copyright -->
					<ul class="copyright">
						<li>&copy; Abbie Bambrough. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
			</div>

		<!-- Scripts -->
			<script>
				// Capture detailed errors and unhandled promise rejections to help debugging.
				window.addEventListener('error', function (e) {
					try {
						console.error('Captured error:', e.message, e.filename + ':' + e.lineno + ':' + e.colno);
						if (e.error && e.error.stack) console.error('Stack:', e.error.stack);
					} catch (err) {
						console.error('Error while reporting error:', err);
					}
				});
				window.addEventListener('unhandledrejection', function (e) {
					try {
						console.error('Unhandled rejection:', e.reason && (e.reason.stack || e.reason));
					} catch (err) {
						console.error('Error while reporting rejection:', err);
					}
				});
			</script>
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script>
				document.addEventListener('DOMContentLoaded', function() {
					// Get project name from URL parameters
					const urlParams = new URLSearchParams(window.location.search);
					const projectName = urlParams.get('project');
					
					if (!projectName) {
						document.getElementById('text-content').innerHTML = '<p>No project specified. Please select a project from the portfolio.</p>';
						return;
					}
					
					// Update page title and header
					document.getElementById('project-title').textContent = projectName.replace(/_/g, ' ');
					document.title = projectName.replace(/_/g, ' ') + ' - Abbie Bambrough';
					
					// Parse an HTML directory listing and return folder hrefs (that end with '/')
					function parseDirectoryListing(html) {
						const parser = new DOMParser();
						const doc = parser.parseFromString(html, 'text/html');
						const anchors = Array.from(doc.querySelectorAll('a[href]'));
						return anchors.map(a => a.getAttribute('href'))
							.filter(h => h && h.endsWith('/'))
							.filter(h => h !== '../');
					}

					// Get all images in a chunk folder
					function getChunkImages(chunkPath) {
						return fetch(chunkPath).then(response => {
							if (!response.ok) return [];
							return response.text();
						}).then(text => {
							if (!text) return [];
							const parser = new DOMParser();
							const doc = parser.parseFromString(text, 'text/html');
							const links = Array.from(doc.querySelectorAll('a[href]'));
							const imageLinks = links.filter(link => /\.(jpe?g|jpeg|png|gif|webp)$/i.test(link.getAttribute('href')));
							
							return imageLinks.map(link => {
								const href = link.getAttribute('href');
								// If href is relative, prefix chunkPath
								if (/^https?:|^\//i.test(href)) return href;
								return chunkPath + href;
							});
						}).catch(() => []);
					}

					// Get description text from chunk
					function getChunkDescription(chunkPath) {
						return fetch(chunkPath + 'Description.txt').then(response => {
							if (!response.ok) return 'No description available for this chunk.';
							return response.text();
						}).catch(() => 'No description available for this chunk.');
					}

					// Find display image for main project image
					function findDisplayImage(projectPath) {
						const displayImagePath = projectPath + 'DISPLAY_IMAGE/';
						return fetch(displayImagePath).then(response => {
							if (!response.ok) return null;
							return response.text();
						}).then(text => {
							if (!text) return null;
							const imageMatch = text.match(/href=["']([^"']+\.(jpe?g|jpeg|png|gif|webp))["']/i);
							if (imageMatch) {
								const candidate = imageMatch[1];
								if (/^https?:|^\//i.test(candidate)) return candidate;
								return displayImagePath + candidate;
							}
							return null;
						}).catch(() => null);
					}

					// Load and display project
					function loadProject() {
						const projectPath = `WORK_DISPLAY/${projectName}/`;
						
						// Load display image for main container
						findDisplayImage(projectPath).then(displayImageUrl => {
							const modelContainer = document.getElementById('detail-image-viewer');
							if (modelContainer && displayImageUrl) {
								modelContainer.innerHTML = '';
								const mainImage = document.createElement('img');
								mainImage.src = displayImageUrl;
								mainImage.alt = projectName + ' main image';
								mainImage.style.width = '100%';
								mainImage.style.height = '100%';
								mainImage.style.objectFit = 'cover';
								modelContainer.appendChild(mainImage);
							}
						});

						// Load chunks
						fetch(projectPath).then(response => {
							if (!response.ok) throw new Error('Project directory not found');
							return response.text();
						}).then(text => {
							const folders = parseDirectoryListing(text);
							// Filter out special folders to get chunk folders
							const chunkFolders = folders.filter(folder => {
								const folderName = folder.replace(/\/$/, '');
								return folderName !== 'DISPLAY_IMAGE' && 
									   folderName !== 'RENDER_IMAGES' && 
									   folderName !== 'CAD_MODEL' && 
									   folderName !== 'OLD_STRUCTURE';
							});

							if (chunkFolders.length === 0) {
								document.getElementById('text-content').innerHTML = '<p>No chunks found in this project.</p>';
								return;
							}

							// Sort chunks naturally (Chunk_1, Chunk_2, etc.)
							chunkFolders.sort((a, b) => {
								const aNum = parseInt(a.match(/\d+/)?.[0] || '0');
								const bNum = parseInt(b.match(/\d+/)?.[0] || '0');
								return aNum - bNum;
							});

							const textContent = document.getElementById('text-content');
							textContent.innerHTML = '';

							const container = document.createElement('div');
							container.className = 'project-chunks';

							// Process each chunk
							const chunkPromises = chunkFolders.map(chunkFolder => {
								const chunkName = chunkFolder.replace(/\/$/, '');
								const chunkPath = projectPath + chunkFolder;

								return Promise.all([
									getChunkImages(chunkPath),
									getChunkDescription(chunkPath)
								]).then(([images, description]) => {
									const chunkDiv = document.createElement('div');
									chunkDiv.className = 'project-chunk';
									chunkDiv.style.marginBottom = '3rem';
									chunkDiv.style.padding = '1rem';
									chunkDiv.style.border = '1px solid #eee';
									chunkDiv.style.borderRadius = '8px';

									// Add chunk title
									const chunkTitle = document.createElement('h3');
									chunkTitle.textContent = chunkName.replace(/_/g, ' ');
									chunkTitle.style.marginBottom = '1rem';
									chunkDiv.appendChild(chunkTitle);

									// Add images in a grid
									if (images.length > 0) {
										const imageGrid = document.createElement('div');
										imageGrid.style.display = 'grid';
										imageGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(250px, 1fr))';
										imageGrid.style.gap = '1rem';
										imageGrid.style.marginBottom = '1rem';

										images.forEach(imageSrc => {
											const img = document.createElement('img');
											img.src = imageSrc;
											img.alt = chunkName + ' image';
											img.style.width = '100%';
											img.style.height = '200px';
											img.style.objectFit = 'cover';
											img.style.borderRadius = '8px';
											img.style.cursor = 'pointer';
											img.style.transition = 'transform 0.3s ease';
											
											img.addEventListener('mouseenter', () => {
												img.style.transform = 'scale(1.05)';
											});
											img.addEventListener('mouseleave', () => {
												img.style.transform = 'scale(1)';
											});
											
											img.onerror = () => {
												console.warn('Chunk image failed to load:', imageSrc);
												img.remove();
											};

											imageGrid.appendChild(img);
										});

										chunkDiv.appendChild(imageGrid);
									}

									// Add description
									const descDiv = document.createElement('div');
									descDiv.className = 'chunk-description';
									descDiv.style.backgroundColor = '#f8f8f8';
									descDiv.style.padding = '1rem';
									descDiv.style.borderRadius = '4px';
									descDiv.innerHTML = `<p>${description.replace(/\n/g, '<br>')}</p>`;
									chunkDiv.appendChild(descDiv);

									return chunkDiv;
								});
							});

							Promise.all(chunkPromises).then(chunkElements => {
								chunkElements.forEach(chunkElement => {
									container.appendChild(chunkElement);
								});
								textContent.appendChild(container);
							});

						}).catch(error => {
							console.error('Error loading project:', error);
							document.getElementById('text-content').innerHTML = '<p>Error loading project details: ' + error.message + '</p>';
						});
					}

					loadProject();
				});
			</script>
	</body>
</html>
